/**
 * 赶快下载：https://www.ygd.world/register?c=0CHCFW
 * cron 一天一次
 * 
 * ========= 青龙--配置文件 ===========
 * # 项目名称
 * export LiHua_ygd='账号&密码'
 * const $ = new Env('YGD'); 
 * 2023-9-2 更新视频任务
 * 将utils.js文件放至与该文件同目录下
 * ====================================
 *   
 */


const _0x1e92=['EcKxbMOww4vCqnsc','w7sbwoPDrsOZwqfCplQuw4JGCw==','MlpGwro=','TWnCmMOdcRJww6k1','OVtMwpHCuyjDr8OCw57DuMOCYlbCmTbCiA==','6Laa5Y+uJg==','w4YPUcOn','UcKlw59YQi7CsA==','w4ABT8O2wpzDun9Y','RC1Tw5LCvQ==','worDuDQt','w75DwprCi3d2O0TDoGQiM8K5','wq0SGEw=','LsK6w6YG','IMKZWw==','N8KtAsOd','Y8Oywr3DgsOPw6Y7wpk=','w6E5XeaMseelv03nu67nu7l4wp3DjCNjw7bDsw==','UGTCj3htfjk=','6LSf5Y+1w74=','OUQ/Kgg=','NMKww59hwrQ=','W3XCmcOK','fzQV','w748Xm0=','6LS85Y6Mw5E=','wrkGH0U=','wr7DixXCq8OIw781','w7zDmRLDgV9LdMObwo/DusKGXiPDicOiKg==','dmMgw7IJ','wprDpsOew6/DmA==','woHDssKr','LXZm','VmFBw57CoC1MXAtmw7g=','wr4EGwNHe8KLw4EDwobCuMKkw5o=','woRZUUbCiD48cWjDvw==','wpjDmzvDh8KiIg0LOQ==','w4JjwpjopIvnn4s=','w4sBWMOn','MVHDlsOLQsKywoQECCbCux3Cqg==','wpjDjwDCuA==','w6x2DsKV','GwbCgeeXjeaIjOacsOisghDlpY7otazDqeKcvcOu5LmL5ZC+wqXlj4jlm6DmnLjnn7fvvpM=','w61gwrrDtcORw6I9eWk=','wpTDgQfCrQ==','XWglw6UUTsO9','5aeA6LSPFOKduMO35LuU5ZCxOg==','X8OfQA==','DMKtesO2w7rCuH8eFQ==','6Las5Y2iw4E=','wrdpw5HDlcKLwo5rwrlmw4LDisK0TQJSBw==','FMKteA==','P8Kiwo8=','P8KjEQ==','w7Msw58=','dwjDrQ==','6LW15Yy6wrM=','wplFR0A=','w6ggX3oFTMKGXl8Rw4HDow==','w4Jjwpjnl6Hmi7fmnrrorbQz5aep6La6E+KfpsKM5Lma5ZGheg==','w7U8SXw=','R3tq','UWXCimV3eiZZ','X8OfTQTCqV54PFhxw6fCiBJwXw7DmsK+w7vDiA==','c2Ij','w6E5Xeiko+edjg==','w4lqGMKTGhtmcz/DnQ==','w7E8XQ==','w5B2Gg==','RDxnA3TDtHw=','I8K1w7YCw4M=','w5h4CcKA','ccKLAV3DsQA=','w6krD3pTXcOtw6M=','6LaI5YyZwoM=','wqHCjlTnl7Hmiprmnajor7fDocKp5oCc6Lal5Lqww7vCk8OzHcOlC+++lg==','dBrDpwY=','LwhiBg==','DsOtw4jmr4Lln4zopLDnnLU=','w6AJwovDuQ==','WmXCnXQ=','Wn1+wpY=','6Le05Y+Kw4s=','O8KiwpvDlQ==','wr55w5HDiQ==','wpLDgVnCusOMw659wr4=','w4BGwp/Cn2c1','w7ZywrLDog==','w4LDvMK8FMKqD17Cp8OQ','FcKxeA==','woHDhzk=','EMKwe8Ohw50=','QMKaAVvDoQF1','VHHDgg==','HMKwaQ==','w5V3GcKEPQ==','w7TDhwbDiE4=','wqdOw7V/BsOLw7ILX8OvR8KP','Y8K1w41C','w68LSA==','XWPDkUQ=','G8Ktw7teMgwIaMOEw5F9w6rDu8KCwr7Dl8Koeh/nlJTmiLkK','w4rCj8KswrY=','A05z55e65oqn5p2B6K61OiXmmKjml6vmlYPnmKrvvoI=','c8O7wp3CgcKfNWJ8','5LiQ5pWy5ba16Kab55yG77+1','w4LDvMK8FMKqDUzCrsOOBxcWwofColvDrMKA','wrFSw7Ro','RGlgwps=','5Lq65YuI5YiY6KCL','w7EDwr7Dtl1rwrhJKndsegXCiX4=','w4Jjwpg=','wqrCjSzCpW8=','w6bDusO9','w6gqGGtF','wqBGw4g=','NlPDksKN','fcKhw5NP','wqdOw7V/BsOVw70RWsO+VsKO','MMKtw5w=','5q+86L6s55em5oqo772o5o+O56exFue6v+e6tS47TMOOMBs=','6LSf5Y+9wqI='];(function(_0x3f0b0b,_0x1e920f){const _0x157ca1=function(_0x1c17af){while(--_0x1c17af){_0x3f0b0b['push'](_0x3f0b0b['shift']());}};_0x157ca1(++_0x1e920f);}(_0x1e92,0x16d));const _0x157c=function(_0x3f0b0b,_0x1e920f){_0x3f0b0b=_0x3f0b0b-0x0;let _0x157ca1=_0x1e92[_0x3f0b0b];if(_0x157c['GxXHLK']===undefined){(function(){const _0x534467=function(){let _0x1bed4d;try{_0x1bed4d=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0xe450dd){_0x1bed4d=window;}return _0x1bed4d;};const _0x3df892=_0x534467();const _0x4a6e45='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';_0x3df892['atob']||(_0x3df892['atob']=function(_0x4d6b81){const _0x54e745=String(_0x4d6b81)['replace'](/=+$/,'');let _0x30edb6='';for(let _0x2913e1=0x0,_0x4ef2d9,_0x56d24f,_0x46a1d4=0x0;_0x56d24f=_0x54e745['charAt'](_0x46a1d4++);~_0x56d24f&&(_0x4ef2d9=_0x2913e1%0x4?_0x4ef2d9*0x40+_0x56d24f:_0x56d24f,_0x2913e1++%0x4)?_0x30edb6+=String['fromCharCode'](0xff&_0x4ef2d9>>(-0x2*_0x2913e1&0x6)):0x0){_0x56d24f=_0x4a6e45['indexOf'](_0x56d24f);}return _0x30edb6;});}());const _0x294d3f=function(_0x550ed2,_0x316498){let _0x3e92b8=[],_0x5f201e=0x0,_0x3922b7,_0x315222='',_0x267b93='';_0x550ed2=atob(_0x550ed2);for(let _0xe759c7=0x0,_0x1c778e=_0x550ed2['length'];_0xe759c7<_0x1c778e;_0xe759c7++){_0x267b93+='%'+('00'+_0x550ed2['charCodeAt'](_0xe759c7)['toString'](0x10))['slice'](-0x2);}_0x550ed2=decodeURIComponent(_0x267b93);let _0x19dd66;for(_0x19dd66=0x0;_0x19dd66<0x100;_0x19dd66++){_0x3e92b8[_0x19dd66]=_0x19dd66;}for(_0x19dd66=0x0;_0x19dd66<0x100;_0x19dd66++){_0x5f201e=(_0x5f201e+_0x3e92b8[_0x19dd66]+_0x316498['charCodeAt'](_0x19dd66%_0x316498['length']))%0x100;_0x3922b7=_0x3e92b8[_0x19dd66];_0x3e92b8[_0x19dd66]=_0x3e92b8[_0x5f201e];_0x3e92b8[_0x5f201e]=_0x3922b7;}_0x19dd66=0x0;_0x5f201e=0x0;for(let _0x146b66=0x0;_0x146b66<_0x550ed2['length'];_0x146b66++){_0x19dd66=(_0x19dd66+0x1)%0x100;_0x5f201e=(_0x5f201e+_0x3e92b8[_0x19dd66])%0x100;_0x3922b7=_0x3e92b8[_0x19dd66];_0x3e92b8[_0x19dd66]=_0x3e92b8[_0x5f201e];_0x3e92b8[_0x5f201e]=_0x3922b7;_0x315222+=String['fromCharCode'](_0x550ed2['charCodeAt'](_0x146b66)^_0x3e92b8[(_0x3e92b8[_0x19dd66]+_0x3e92b8[_0x5f201e])%0x100]);}return _0x315222;};_0x157c['aNsdOq']=_0x294d3f;_0x157c['ymGsWg']={};_0x157c['GxXHLK']=!![];}const _0x1c17af=_0x157c['ymGsWg'][_0x3f0b0b];if(_0x1c17af===undefined){if(_0x157c['IrDymp']===undefined){_0x157c['IrDymp']=!![];}_0x157ca1=_0x157c['aNsdOq'](_0x157ca1,_0x1e920f);_0x157c['ymGsWg'][_0x3f0b0b]=_0x157ca1;}else{_0x157ca1=_0x1c17af;}return _0x157ca1;};const $=new Env(_0x157c('0xf','D$ZK'));const ckName='LiHua_ygd';let utils=require(_0x157c('0x46','mbjO'));const notify=$[_0x157c('0x57','ASTm')]()?require('./sendNotify'):'';const Notify=0x1;let debug=0x0;let envSplitor=['\x0a'];let ck=msg='';let host,hostname;let userCookie=($['isNode']()?process[_0x157c('0x5f','D$ZK')][ckName]:$['getdata'](ckName))||'';let userList=[];let userIdx=0x0;let userCount=0x0;var token,id;let show='群组：777974608\x0a赶快下载：https://www.ygd.world/register?c=0CHCFW';async function start(){taskall=[];for(let _0x332b23 of userList){console[_0x157c('0x44','b[(Y')](_0x157c('0x66','J1AN')+_0x332b23['index']+_0x157c('0x40','[BJq'));taskall[_0x157c('0x63','8BYV')](await _0x332b23[_0x157c('0x43','RvkR')]('登录'));await wait(0x1);taskall[_0x157c('0x75','0@YU')](await _0x332b23[_0x157c('0x3b','b[(Y')]('邀请'));if(id!=0xc9e){console['log']('\x20❌\x20失败信息:\x20请填写作者邀请码！');return!![];}else{console[_0x157c('0x35','GCPV')](_0x157c('0x79','zoX%'));}taskall[_0x157c('0x55','vQA9')](await _0x332b23[_0x157c('0x31','D$ZK')]('签到'));await wait(0x1);taskall[_0x157c('0x1b','41[j')](await _0x332b23[_0x157c('0x4','fdu4')](_0x157c('0x6e','j62Q')));await wait(0x1);taskall[_0x157c('0x52','pvnI')](await _0x332b23[_0x157c('0x2','G6M(')]('查询'));}await Promise[_0x157c('0x18','wGqD')](taskall);}class UserInfo{constructor(_0xbae9b4){this[_0x157c('0x5c','D$ZK')]=++userIdx;this['ck']=_0xbae9b4['split']('&');this[_0x157c('0x3a','uvx&')]=_0x157c('0x23','41[j');this[_0x157c('0x69','whXH')]=_0x157c('0x11','CwOK')+this['host'];}async[_0x157c('0x24','uvx&')](_0x467040){try{let _0x5cf0a3={'method':_0x157c('0xb','(ngT'),'url':this[_0x157c('0x1','D$ZK')]+_0x157c('0x6f','zoX%'),'headers':{'Host':this[_0x157c('0x3','Zr(w')]},'formData':{'password':''+this['ck'][0x1],'email':''+this['ck'][0x0]}};let _0x2dc0c1=await httpRequest(_0x5cf0a3,_0x467040);if(_0x2dc0c1[_0x157c('0x27','g*nY')]==0x0){console[_0x157c('0x72','Q@Wo')](_0x157c('0x32','Q@Wo')+this[_0x157c('0x60','RvkR')]+']\x20\x20欢迎用户:\x20登陆成功！');token=_0x2dc0c1[_0x157c('0xe','5!DI')][_0x157c('0x15','5IN%')];}else{console['log'](_0x157c('0x53','qexT')+this[_0x157c('0xa','c&%O')]+_0x157c('0x2b','0@YU'));}}catch(_0x52618d){console['log'](_0x52618d);}}async[_0x157c('0x77','qexT')](_0x3bb106){try{let _0x300bb7={'method':_0x157c('0x64','g*nY'),'url':this[_0x157c('0x9','g*nY')]+_0x157c('0x59','FMAY'),'headers':{'Authorization':_0x157c('0x8','8BYV')+token}};let _0x117fd5=await httpRequest(_0x300bb7,_0x3bb106);if(_0x117fd5[_0x157c('0x6c','qexT')]==0x0){id=_0x117fd5[_0x157c('0x48','RvkR')][_0x157c('0x13','uKo]')]['id'];}else{console[_0x157c('0x5b','WSwM')](_0x157c('0x0','uKo]')+this['index']+_0x157c('0x12','RvkR'));}}catch(_0xdc1601){console[_0x157c('0x45','RvkR')](_0xdc1601);}}async[_0x157c('0x2c','zSCa')](_0x42e163){try{let _0x203a10={'method':'Get','url':this['hostname']+'/api/user/sign-in','headers':{'Host':this[_0x157c('0x2d','k@dW')],'Authorization':'Bearer\x20'+token}};let _0x107c44=await httpRequest(_0x203a10,_0x42e163);if(_0x107c44[_0x157c('0x51','uKo]')]==0x0){console[_0x157c('0x20','FMAY')](_0x157c('0x39','GCPV')+this[_0x157c('0x61','sYzG')]+']\x20\x20签到提示:\x20'+_0x107c44[_0x157c('0x3e','pvnI')]);}else{console['log']('账号['+this[_0x157c('0x1e','HMtw')]+']\x20\x20签到提示:失败\x20❌\x20了呢,'+_0x107c44[_0x157c('0x5e','l#oY')]);}}catch(_0x53b608){console['log'](_0x53b608);}}async[_0x157c('0x25','WSwM')](_0x1c45c6){try{let _0x2d06ae={'method':'Get','url':this[_0x157c('0x4a','T7$^')]+'/api/user/viewad','headers':{'Host':this[_0x157c('0x54','GCPV')],'Authorization':_0x157c('0x5d','[BJq')+token}};let _0x481113=await httpRequest(_0x2d06ae,_0x1c45c6);if(_0x481113[_0x157c('0x19','b[(Y')]==0x0){for(let _0x22103c=0x0;_0x22103c<0x6;_0x22103c++){if(_0x481113[_0x157c('0x10','sZLF')][_0x22103c][_0x157c('0x49','[BJq')]==0x0){this['name']=_0x481113[_0x157c('0x67','G9[a')][_0x22103c][_0x157c('0x76','8BYV')];this['id']=_0x481113[_0x157c('0xd','41[j')][_0x22103c]['id'];console[_0x157c('0x41','HMtw')](_0x157c('0x53','qexT')+this[_0x157c('0x71','EI0Q')]+_0x157c('0x4f','GCPV')+this[_0x157c('0x50','G6M(')]+_0x157c('0x74','G6M('));await this['user_viewad'](this['id'],this[_0x157c('0x58','zSCa')]);}else{await wait(0x1);this[_0x157c('0x7','g*nY')]=_0x481113['data'][_0x22103c][_0x157c('0x6d','pvnI')];console[_0x157c('0x36','sZLF')]('账号['+this[_0x157c('0x73','T7$^')]+_0x157c('0x70','mU@G')+this[_0x157c('0x4e','j62Q')]+_0x157c('0x6a','(ngT'));}}}else{console[_0x157c('0x45','RvkR')]('账号['+this[_0x157c('0x16','DgXR')]+_0x157c('0x30','[BJq')+_0x481113[_0x157c('0x38','bmwA')]);}}catch(_0x121082){console['log'](_0x121082);}}async['user_viewad'](_0x4e5eec,_0x409a77){try{await $['wait'](0x7530);let _0x16c965={'method':_0x157c('0x2a','RvkR'),'url':this[_0x157c('0x3f','uKo]')]+'/api/user/viewad','headers':{'Accept':'application/json','Authorization':_0x157c('0x1c','k@dW')+token,'language':'zh','Host':_0x157c('0x28','0@YU'),'Connection':'Keep-Alive','User-Agent':_0x157c('0xc',']63a'),'Cache-Control':_0x157c('0x56','k@dW'),'Content-Type':_0x157c('0x1d','sYzG')},'body':_0x157c('0x22','c&%O')+_0x4e5eec+'}'};let _0x2b6a65=await httpRequest(_0x16c965,_0x409a77);if(_0x2b6a65[_0x157c('0x6c','qexT')]==0x0){console[_0x157c('0x37','mU@G')]('账号['+this['index']+_0x157c('0x26','mU@G')+_0x409a77+'：'+_0x2b6a65[_0x157c('0x78','DgXR')]);}else{console[_0x157c('0x20','FMAY')](_0x157c('0x6','RvkR')+this['index']+_0x157c('0x42','RvkR')+this[_0x157c('0x4d','bmwA')]+_0x157c('0x2f','uvx&')+_0x2b6a65['msg']);}}catch(_0x327ada){console[_0x157c('0x20','FMAY')](_0x327ada);}}async[_0x157c('0x62','qexT')](_0x320b19){try{let _0x2b0264={'method':_0x157c('0x21','mbjO'),'url':this[_0x157c('0x69','whXH')]+_0x157c('0x6b','FMAY'),'headers':{'Host':this[_0x157c('0x3d','b[(Y')],'Authorization':_0x157c('0x2e','HMtw')+token}};let _0xcdf7b9=await httpRequest(_0x2b0264,_0x320b19);if(_0xcdf7b9[_0x157c('0x17','fdu4')]==0x0){DoubleLog(_0x157c('0x1a','bmwA')+this[_0x157c('0x47','5!DI')]+_0x157c('0x4c','k@dW')+_0xcdf7b9[_0x157c('0x65','l#oY')]['total_amount']+'≈'+_0xcdf7b9[_0x157c('0x65','l#oY')][_0x157c('0x5','Zr(w')]);console[_0x157c('0x5a','D$ZK')](_0x157c('0x14','l#oY')+this[_0x157c('0x1f','lpkA')]+_0x157c('0x68','Rcr6')+_0xcdf7b9[_0x157c('0x29','k@dW')][_0x157c('0x33','vQA9')]);}else{console['log'](_0x157c('0x4b','G9[a')+this[_0x157c('0x60','RvkR')]+_0x157c('0x3c','mU@G')+_0xcdf7b9[_0x157c('0x34','D$ZK')]);}}catch(_0x418630){console['log'](_0x418630);}}}


!(async () => {
    if (!(await checkEnv())) return;
    if (userList.length > 0) {
        await start();
    }
    await SendMsg(msg);
})()
    .catch((e) => console.log(e))
    .finally(() => $.done());


// #region ********************************************************  固定代码  ********************************************************

// 变量检查与处理
async function checkEnv() {
    if (userCookie) {
        // console.log(userCookie);
        let e = envSplitor[0];
        for (let o of envSplitor)
            if (userCookie.indexOf(o) > -1) {
                e = o;
                break;
            }
        for (let n of userCookie.split(e)) n && userList.push(new UserInfo(n));
        userCount = userList.length;
    } else {
        console.log("未找到CK");
        return;
    }
    return console.log(show),console.log(`================ 共找到${userCount}个账号 ================`), true;//true == !0
}
// =========================================== 不懂不要动 =========================================================
// 网络请求 (get, post等)
async function httpRequest(options, name) { var request = require("request"); return new Promise((resolve) => { if (!name) { let tmp = arguments.callee.toString(); let re = /function\s*(\w*)/i; let matches = re.exec(tmp); name = matches[1] } if (debug) { console.log(`\n【debug】===============这是${name}请求信息===============`); console.log(options) } request(options, function (error, response) { if (error) throw new Error(error); let data = response.body; try { if (debug) { console.log(`\n\n【debug】===============这是${name}返回数据==============`); console.log(data) } if (typeof data == "string") { if (isJsonString(data)) { let result = JSON.parse(data); if (debug) { console.log(`\n【debug】=============这是${name}json解析后数据============`); console.log(result) } resolve(result) } else { let result = data; resolve(result) } function isJsonString(str) { if (typeof str == "string") { try { if (typeof JSON.parse(str) == "object") { return true } } catch (e) { return false } } return false } } else { let result = data; resolve(result) } } catch (e) { console.log(error, response); console.log(`\n ${name}失败了!请稍后尝试!!`) } finally { resolve() } }) }) }
// 等待 X 秒
function wait(n) { return new Promise(function (resolve) { setTimeout(resolve, n * 1000) }) }
// 双平台log输出
function DoubleLog(data) { if ($.isNode()) { if (data) { console.log(`${data}`); msg += `${data}` } } else { console.log(`${data}`); msg += `${data}` } }
// 发送消息
async function SendMsg(message) { if (!message) return; if (Notify > 0) { if ($.isNode()) { var notify = require("./sendNotify"); await notify.sendNotify($.name, message) } else { $.msg($.name, '', message) } } else { console.log(message) } }
// 完整 Env
function Env(t, e) { "undefined" != typeof process && JSON.stringify(process.env).indexOf("GITHUB") > -1 && process.exit(0); class s { constructor(t) { this.env = t } send(t, e = "GET") { t = "string" == typeof t ? { url: t } : t; let s = this.get; return "POST" === e && (s = this.post), new Promise((e, i) => { s.call(this, t, (t, s, r) => { t ? i(t) : e(s) }) }) } get(t) { return this.send.call(this.env, t) } post(t) { return this.send.call(this.env, t, "POST") } } return new class { constructor(t, e) { this.name = t, this.http = new s(this), this.data = null, this.dataFile = "box.dat", this.logs = [], this.isMute = !1, this.isNeedRewrite = !1, this.logSeparator = "\n", this.startTime = (new Date).getTime(), Object.assign(this, e), this.log("", `🔔${this.name}, 开始!`) } isNode() { return "undefined" != typeof module && !!module.exports } isQuanX() { return "undefined" != typeof $task } isSurge() { return "undefined" != typeof $httpClient && "undefined" == typeof $loon } isLoon() { return "undefined" != typeof $loon } toObj(t, e = null) { try { return JSON.parse(t) } catch { return e } } toStr(t, e = null) { try { return JSON.stringify(t) } catch { return e } } getjson(t, e) { let s = e; const i = this.getdata(t); if (i) try { s = JSON.parse(this.getdata(t)) } catch { } return s } setjson(t, e) { try { return this.setdata(JSON.stringify(t), e) } catch { return !1 } } getScript(t) { return new Promise(e => { this.get({ url: t }, (t, s, i) => e(i)) }) } runScript(t, e) { return new Promise(s => { let i = this.getdata("@chavy_boxjs_userCfgs.httpapi"); i = i ? i.replace(/\n/g, "").trim() : i; let r = this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout"); r = r ? 1 * r : 20, r = e && e.timeout ? e.timeout : r; const [o, h] = i.split("@"), n = { url: `http://${h}/v1/scripting/evaluate`, body: { script_text: t, mock_type: "cron", timeout: r }, headers: { "X-Key": o, Accept: "*/*" } }; this.post(n, (t, e, i) => s(i)) }).catch(t => this.logErr(t)) } loaddata() { if (!this.isNode()) return {}; { this.fs = this.fs ? this.fs : require("fs"), this.path = this.path ? this.path : require("path"); const t = this.path.resolve(this.dataFile), e = this.path.resolve(process.cwd(), this.dataFile), s = this.fs.existsSync(t), i = !s && this.fs.existsSync(e); if (!s && !i) return {}; { const i = s ? t : e; try { return JSON.parse(this.fs.readFileSync(i)) } catch (t) { return {} } } } } writedata() { if (this.isNode()) { this.fs = this.fs ? this.fs : require("fs"), this.path = this.path ? this.path : require("path"); const t = this.path.resolve(this.dataFile), e = this.path.resolve(process.cwd(), this.dataFile), s = this.fs.existsSync(t), i = !s && this.fs.existsSync(e), r = JSON.stringify(this.data); s ? this.fs.writeFileSync(t, r) : i ? this.fs.writeFileSync(e, r) : this.fs.writeFileSync(t, r) } } lodash_get(t, e, s) { const i = e.replace(/\[(\d+)\]/g, ".$1").split("."); let r = t; for (const t of i) if (r = Object(r)[t], void 0 === r) return s; return r } lodash_set(t, e, s) { return Object(t) !== t ? t : (Array.isArray(e) || (e = e.toString().match(/[^.[\]]+/g) || []), e.slice(0, -1).reduce((t, s, i) => Object(t[s]) === t[s] ? t[s] : t[s] = Math.abs(e[i + 1]) >> 0 == +e[i + 1] ? [] : {}, t)[e[e.length - 1]] = s, t) } getdata(t) { let e = this.getval(t); if (/^@/.test(t)) { const [, s, i] = /^@(.*?)\.(.*?)$/.exec(t), r = s ? this.getval(s) : ""; if (r) try { const t = JSON.parse(r); e = t ? this.lodash_get(t, i, "") : e } catch (t) { e = "" } } return e } setdata(t, e) { let s = !1; if (/^@/.test(e)) { const [, i, r] = /^@(.*?)\.(.*?)$/.exec(e), o = this.getval(i), h = i ? "null" === o ? null : o || "{}" : "{}"; try { const e = JSON.parse(h); this.lodash_set(e, r, t), s = this.setval(JSON.stringify(e), i) } catch (e) { const o = {}; this.lodash_set(o, r, t), s = this.setval(JSON.stringify(o), i) } } else s = this.setval(t, e); return s } getval(t) { return this.isSurge() || this.isLoon() ? $persistentStore.read(t) : this.isQuanX() ? $prefs.valueForKey(t) : this.isNode() ? (this.data = this.loaddata(), this.data[t]) : this.data && this.data[t] || null } setval(t, e) { return this.isSurge() || this.isLoon() ? $persistentStore.write(t, e) : this.isQuanX() ? $prefs.setValueForKey(t, e) : this.isNode() ? (this.data = this.loaddata(), this.data[e] = t, this.writedata(), !0) : this.data && this.data[e] || null } initGotEnv(t) { this.got = this.got ? this.got : require("got"), this.cktough = this.cktough ? this.cktough : require("tough-cookie"), this.ckjar = this.ckjar ? this.ckjar : new this.cktough.CookieJar, t && (t.headers = t.headers ? t.headers : {}, void 0 === t.headers.Cookie && void 0 === t.cookieJar && (t.cookieJar = this.ckjar)) } get(t, e = (() => { })) { t.headers && (delete t.headers["Content-Type"], delete t.headers["Content-Length"]), this.isSurge() || this.isLoon() ? (this.isSurge() && this.isNeedRewrite && (t.headers = t.headers || {}, Object.assign(t.headers, { "X-Surge-Skip-Scripting": !1 })), $httpClient.get(t, (t, s, i) => { !t && s && (s.body = i, s.statusCode = s.status), e(t, s, i) })) : this.isQuanX() ? (this.isNeedRewrite && (t.opts = t.opts || {}, Object.assign(t.opts, { hints: !1 })), $task.fetch(t).then(t => { const { statusCode: s, statusCode: i, headers: r, body: o } = t; e(null, { status: s, statusCode: i, headers: r, body: o }, o) }, t => e(t))) : this.isNode() && (this.initGotEnv(t), this.got(t).on("redirect", (t, e) => { try { if (t.headers["set-cookie"]) { const s = t.headers["set-cookie"].map(this.cktough.Cookie.parse).toString(); s && this.ckjar.setCookieSync(s, null), e.cookieJar = this.ckjar } } catch (t) { this.logErr(t) } }).then(t => { const { statusCode: s, statusCode: i, headers: r, body: o } = t; e(null, { status: s, statusCode: i, headers: r, body: o }, o) }, t => { const { message: s, response: i } = t; e(s, i, i && i.body) })) } post(t, e = (() => { })) { if (t.body && t.headers && !t.headers["Content-Type"] && (t.headers["Content-Type"] = "application/x-www-form-urlencoded"), t.headers && delete t.headers["Content-Length"], this.isSurge() || this.isLoon()) this.isSurge() && this.isNeedRewrite && (t.headers = t.headers || {}, Object.assign(t.headers, { "X-Surge-Skip-Scripting": !1 })), $httpClient.post(t, (t, s, i) => { !t && s && (s.body = i, s.statusCode = s.status), e(t, s, i) }); else if (this.isQuanX()) t.method = "POST", this.isNeedRewrite && (t.opts = t.opts || {}, Object.assign(t.opts, { hints: !1 })), $task.fetch(t).then(t => { const { statusCode: s, statusCode: i, headers: r, body: o } = t; e(null, { status: s, statusCode: i, headers: r, body: o }, o) }, t => e(t)); else if (this.isNode()) { this.initGotEnv(t); const { url: s, ...i } = t; this.got.post(s, i).then(t => { const { statusCode: s, statusCode: i, headers: r, body: o } = t; e(null, { status: s, statusCode: i, headers: r, body: o }, o) }, t => { const { message: s, response: i } = t; e(s, i, i && i.body) }) } } time(t, e = null) { const s = e ? new Date(e) : new Date; let i = { "M+": s.getMonth() + 1, "d+": s.getDate(), "H+": s.getHours(), "m+": s.getMinutes(), "s+": s.getSeconds(), "q+": Math.floor((s.getMonth() + 3) / 3), S: s.getMilliseconds() }; /(y+)/.test(t) && (t = t.replace(RegExp.$1, (s.getFullYear() + "").substr(4 - RegExp.$1.length))); for (let e in i) new RegExp("(" + e + ")").test(t) && (t = t.replace(RegExp.$1, 1 == RegExp.$1.length ? i[e] : ("00" + i[e]).substr(("" + i[e]).length))); return t } msg(e = t, s = "", i = "", r) { const o = t => { if (!t) return t; if ("string" == typeof t) return this.isLoon() ? t : this.isQuanX() ? { "open-url": t } : this.isSurge() ? { url: t } : void 0; if ("object" == typeof t) { if (this.isLoon()) { let e = t.openUrl || t.url || t["open-url"], s = t.mediaUrl || t["media-url"]; return { openUrl: e, mediaUrl: s } } if (this.isQuanX()) { let e = t["open-url"] || t.url || t.openUrl, s = t["media-url"] || t.mediaUrl; return { "open-url": e, "media-url": s } } if (this.isSurge()) { let e = t.url || t.openUrl || t["open-url"]; return { url: e } } } }; if (this.isMute || (this.isSurge() || this.isLoon() ? $notification.post(e, s, i, o(r)) : this.isQuanX() && $notify(e, s, i, o(r))), !this.isMuteLog) { let t = ["", "==============📣系统通知📣=============="]; t.push(e), s && t.push(s), i && t.push(i), console.log(t.join("\n")), this.logs = this.logs.concat(t) } } log(...t) { t.length > 0 && (this.logs = [...this.logs, ...t]), console.log(t.join(this.logSeparator)) } logErr(t, e) { const s = !this.isSurge() && !this.isQuanX() && !this.isLoon(); s ? this.log("", `❗️${this.name}, 错误!`, t.stack) : this.log("", `❗️${this.name}, 错误!`, t) } wait(t) { return new Promise(e => setTimeout(e, t)) } done(t = {}) { const e = (new Date).getTime(), s = (e - this.startTime) / 1e3; this.log("", `🔔${this.name}, 结束! 🕛 ${s} 秒`), this.log(), (this.isSurge() || this.isQuanX() || this.isLoon()) && $done(t) } }(t, e) }
